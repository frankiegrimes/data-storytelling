function chart2(){var t=1*parseInt(d3.select("#chart-2").style("width")),a=t/1.3,e=t/50;d3.csv("../assets/data/cisgender-int.csv",function(t){return{answer:t.Answer,post:t.Post,pre:t.Pre}},function(n,r){var l=r[0].pre;console.log(r[1].post);var s=d3.max(d3.values(l)),o=d3.scale.linear().domain([0,s]).range([0,a]),i=d3.scale.linear().domain([0,100]).range([a-e,e]),c=d3.scale.linear().domain([0,s]).range(["lightblue","blue"]),d=d3.svg.axis().orient("right").scale(i),u=d3.select("#chart-2").append("svg").attr("width",t).attr("height",a).append("g");u.selectAll("rect").data(l).enter().append("rect").attr("x",function(a,e){return e*(t/l.length)}).attr("y",function(t){return a-o(t)}).attr("width",t/l.length-e).attr("height",function(t){return o(t)}).attr("fill",function(t){return c(t)}),u.selectAll("text").data(l).enter().append("text").text(function(t){return t+"%"}).attr("text-anchor","bottom").attr("x",function(a,n){return n*(t/l.length)+(t/l.length-e)/2}).attr("y",function(t){return a-2*t}).attr("font-family","'Open Sans'").attr("font-size","1rem").attr("fill","white"),u.append("g").attr("transform","translate("+e+",0").call(d)})}function graph3(){var t={top:20,right:20,bottom:30,left:40},a=2.5*parseInt(d3.select("#chart-3").style("width"))-t.left-t.right;height=a/1.5-t.top-t.bottom;var e=d3.format(".0%"),n=d3.scale.ordinal().rangeRoundBands([0,a],.1,1),r=d3.scale.linear().range([height,0]),l=d3.svg.axis().scale(n).orient("bottom"),s=d3.svg.axis().scale(r).orient("left").tickFormat(e),o=d3.select("#chart-3").append("svg").attr("width",a+t.left+t.right).attr("height",height+t.top+t.bottom).append("g").attr("transform","translate("+t.left+","+t.top+")");d3.tsv("assets/data/organisations-int.csv",function(t,a){function e(){clearTimeout(i);var t=n.domain(a.sort(this.checked?function(t,a){return a.post-t.post}:function(t,a){return d3.ascending(t.organisation,a.organisation)}).map(function(t){return t.organisation})).copy();o.selectAll(".bar").sort(function(a,e){return t(a.organisation)-t(e.organisation)});var e=o.transition().duration(750),r=function(t,a){return 50*a};e.selectAll(".bar").delay(r).attr("x",function(a){return t(a.organisation)}),e.select(".x.axis").call(l).selectAll("g").delay(r)}a.forEach(function(t){t.post=+t.post}),n.domain(a.map(function(t){return t.organisation})),r.domain([0,d3.max(a,function(t){return t.post})]),o.append("g").attr("class","x axis").attr("transform","translate(0,"+height+")").call(l),o.append("g").attr("class","y axis").call(s).append("text").attr("transform","rotate(-90)").attr("y",6).attr("dy",".71em").style("text-anchor","end").text("Post-Internet"),o.selectAll(".bar").data(a).enter().append("rect").attr("class","bar").attr("x",function(t){return n(t.organisation)}).attr("width",n.rangeBand()).attr("y",function(t){return r(t.post)}).attr("height",function(t){return height-r(t.post)}),d3.select("input").on("change",e);var i=setTimeout(function(){d3.select("input").property("checked",!0).each(e)},2e3)})}function graph5(){function t(t){var a=(t.endAngle-t.startAngle)/t.value;return d3.range(0,t.value,1e3).map(function(e,n){return{angle:e*a+t.startAngle,label:n%5?null:e/1e3+"k"}})}function a(t){return function(a,e){c.selectAll(".chord path").filter(function(t){return t.source.index!=e&&t.target.index!=e}).transition().style("opacity",t)}}var e=[[11975,5871,8916,2868],[1951,10048,2060,6171],[8010,16145,8090,8045],[1013,990,940,6907]],n=d3.layout.chord().padding(.05).sortSubgroups(d3.descending).matrix(e),r=parseInt(d3.select("#chart-5").style("width")),l=r/2,s=.41*Math.min(r,l),o=1.1*s,i=d3.scale.ordinal().domain(d3.range(4)).range(["#000000","#FFDD89","#957244","#F26223"]),c=d3.select("#chart-5").append("svg").attr("width",r).attr("height",l).append("g").attr("transform","translate("+r/2+","+l/2+")");c.append("g").selectAll("path").data(n.groups).enter().append("path").style("fill",function(t){return i(t.index)}).style("stroke",function(t){return i(t.index)}).attr("d",d3.svg.arc().innerRadius(s).outerRadius(o)).on("mouseover",a(.1)).on("mouseout",a(1));var d=c.append("g").selectAll("g").data(n.groups).enter().append("g").selectAll("g").data(t).enter().append("g").attr("transform",function(t){return"rotate("+(180*t.angle/Math.PI-90)+")translate("+o+",0)"});d.append("line").attr("x1",1).attr("y1",0).attr("x2",5).attr("y2",0).style("stroke","#000"),d.append("text").attr("x",8).attr("dy",".35em").attr("transform",function(t){return t.angle>Math.PI?"rotate(180)translate(-16)":null}).style("text-anchor",function(t){return t.angle>Math.PI?"end":null}).text(function(t){return t.label}),c.append("g").attr("class","chord").selectAll("path").data(n.chords).enter().append("path").attr("d",d3.svg.chord().radius(s)).style("fill",function(t){return i(t.target.index)}).style("opacity",1)}function render(t){var a=d3.select("#slide-8").append("svg").attr("width",w).attr("height",h);a.selectAll("rect").data(t.values).enter().append("rect").attr("x",function(a,e){return e*(w/t.values.length)}).attr("y",function(t){return parseInt(h-t)}).attr("width",w/t.values.length-barPadding).attr("height",function(t){return parseInt(t)}).attr("fill",function(t,a){var e="rgb("+Math.round(255*Math.random())+", "+Math.round(255*Math.random())+", "+Math.round(255*Math.random())+")";return e}),a.append("text").text(t.name).attr({x:0,y:30})}!function(t){var a=[{label:"Newspapers",count:77},{label:"Television",count:140},{label:"Magazines",count:71},{label:"Film",count:114},{label:"Books",count:38},{label:"Radio",count:38},{label:"Internet",count:136}],e=1.5*parseInt(t.select("#chart-1").style("width")),n=e,r=Math.min(e,n)/2,l=e/5,s=e/20,o=e/100,i=t.scale.category20b(),c=t.select("#chart-1").append("svg").attr("width",e).attr("height",n).append("g").attr("transform","translate("+e/2+","+n/2+")"),d=t.svg.arc().innerRadius(r-l).outerRadius(r),u=t.layout.pie().value(function(t){return t.count}).sort(null),p=t.select("#chart-1").append("div").attr("class","tooltip");p.append("div").attr("class","label"),p.append("div").attr("class","count"),p.append("div").attr("class","percent"),a.forEach(function(t){t.count=+t.count,t.enabled=!0});var h=c.selectAll("path").data(u(a)).enter().append("path").attr("d",d).attr("fill",function(t,a){return i(t.data.label)}).each(function(t){this._current=t});h.on("mouseover",function(e){var n=t.sum(a.map(function(t){return t.enabled?t.count:0})),r=Math.round(1e3*e.data.count/n)/10;p.select(".label").html(e.data.label),p.select(".count").html(e.data.count),p.select(".percent").html(r+"%"),p.style("display","block")}),h.on("mouseout",function(t){p.style("display","none")});var g=c.selectAll(".legend").data(i.domain()).enter().append("g").attr("class","legend").attr("transform",function(t,a){var e=s+o,n=e*i.domain().length/2,r=-2*s,l=a*e-n;return"translate("+r+","+l+")"});g.append("rect").attr("width",s).attr("height",s).style("fill",i).style("stroke",i).on("click",function(e){var n=t.select(this),r=!0,l=t.sum(a.map(function(t){return t.enabled?1:0}));if("disabled"===n.attr("class"))n.attr("class","");else{if(2>l)return;n.attr("class","disabled"),r=!1}u.value(function(t){return t.label===e&&(t.enabled=r),t.enabled?t.count:0}),h=h.data(u(a)),h.transition().duration(750).attrTween("d",function(a){var e=t.interpolate(this._current,a);return this._current=e(0),function(t){return d(e(t))}})}),g.append("text").attr("x",s+o).attr("y",s-o).text(function(t){return t})}(window.d3),chart2(),graph3(),graph5();var margin={top:20,right:20,bottom:30,left:40},width=parseInt(d3.select("#chart-4").style("width"))/4,height=width/3-margin.top-margin.bottom,x0=d3.scale.ordinal().rangeRoundBands([0,width],.1),x1=d3.scale.ordinal(),y=d3.scale.linear().range([height,0]),color=d3.scale.ordinal().range(["#98abc5","#8a89a6","#7b6888","#6b486b","#a05d56","#d0743c","#ff8c00"]),xAxis=d3.svg.axis().scale(x0).orient("bottom"),yAxis=d3.svg.axis().scale(y).orient("left").tickFormat(d3.format(".2s")),svg=d3.select("#chart-4").append("svg").attr("width",width+margin.left+margin.right).attr("height",height+margin.top+margin.bottom).append("g").attr("transform","translate("+margin.left+","+margin.top+")");d3.csv("../assets/data/data.csv",function(t,a){if(t)throw t;var e=d3.keys(a[0]).filter(function(t){return"State"!==t});a.forEach(function(t){t.ages=e.map(function(a){return{name:a,value:+t[a]}})}),x0.domain(a.map(function(t){return t.State})),x1.domain(e).rangeRoundBands([0,x0.rangeBand()]),y.domain([0,d3.max(a,function(t){return d3.max(t.ages,function(t){return t.value})})]),svg.append("g").attr("class","x axis").attr("transform","translate(0,"+height+")").call(xAxis),svg.append("g").attr("class","y axis").call(yAxis).append("text").attr("transform","rotate(-90)").attr("y",6).attr("dy",".71em").style("text-anchor","end").text("Population");var n=svg.selectAll(".state").data(a).enter().append("g").attr("class","state").attr("transform",function(t){return"translate("+x0(t.State)+",0)"});n.selectAll("rect").data(function(t){return t.ages}).enter().append("rect").attr("width",x1.rangeBand()).attr("x",function(t){return x1(t.name)}).attr("y",function(t){return y(t.value)}).attr("height",function(t){return height-y(t.value)}).style("fill",function(t){return color(t.name)});var r=svg.selectAll(".legend").data(e.slice().reverse()).enter().append("g").attr("class","legend").attr("transform",function(t,a){return"translate(0,"+20*a+")"});r.append("rect").attr("x",width-18).attr("width",18).attr("height",18).style("fill",color),r.append("text").attr("x",width-24).attr("y",9).attr("dy",".35em").style("text-anchor","end").text(function(t){return t})}),graph4();var browsers=[],w=500,h=100,barPadding=3;d3.csv("../assets/data/choice-age.csv",function(t,a){a.forEach(function(t){browsers.push({reply:t.answer,values:[t[18],t[25],t[35]]})}),browsers.forEach(function(t){render(t)})});